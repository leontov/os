Колибри OS — легковесная экспериментальная платформа, объединяющая KolibriScript, симулятор и набор утилит для отладки цифровых сценариев. Этот документ описывает, как развернуть окружение разработчика, какие каталоги за что отвечают и какие команды автоматизируют сборку.

## Структура репозитория
| Категория         | Каталоги                                          | Назначение |
|-------------------|---------------------------------------------------|------------|
| Продуктивный код  | `apps/`, `backend/`, `core/`, `frontend/`, `kernel/`, `training/`, `wasm/` | Исполняемые компоненты, библиотеки ядра и обвязка WASM/фронтенда. |
| Данные            | `data/`, `logs/`                                  | Встроенные артефакты (bootstrap-скрипты, тестовые логи, примеры данных). |
| Операции          | `scripts/` (см. [описание](scripts/README.md)), `deploy/` | Инфраструктурные и CI-скрипты, сборочные утилиты, сценарии деплоя. |
| Эксперименты      | `experiments/`                                    | Исследовательские утилиты и одноразовые пайплайны обучения. |
| Архив             | `archive/`                                        | Унаследованные артефакты и сохранённые результаты (не участвуют в сборке). |

Базовые данные для сервера знаний перенесены в `data/bootstrap/knowledge_bootstrap.ks`. Папки с неиспользуемыми файлами
(`danniye`, `dlina`, `poziciya` и т.п.) собраны в `archive/legacy_placeholders/`, чтобы не загромождать корень.

## Быстрый старт
1. Подготовьте инструменты: Python 3.10+, CMake 3.20+, Ninja (или Make), Node.js 20+, npm, compilers (gcc/clang).
2. Запустите базовый конвейер сборки из корня репозитория:
   ```bash
   make pipeline
   ```
   Цель создаёт виртуальное окружение Python, собирает C-ядро, wasm и фронтенд.
3. Выполните проверки качества и тесты:
   ```bash
   make lint
   make test
   ```
4. Для полной сборки артефактов (ISO, SBOM) используйте:
   ```bash
   make ci
   ```

## Часто используемые команды
| Команда       | Действие |
|---------------|----------|
| `make pipeline` | Подготовка виртуального окружения Python, сборка C-ядра, wasm и фронтенда. |
| `make lint`     | Запуск `ruff` и `pyright` из виртуального окружения. |
| `make test`     | `ctest`, `pytest` и фронтендовые тесты (`npm test --runInBand`). |
| `make ci`       | Полный конвейер (pipeline + lint + test) и генерация ISO/SBOM. |
| `make clean`    | Очистка `build/`, `.venv/`, артефактов фронтенда и wasm. |

Все вспомогательные скрипты задокументированы в [`scripts/README.md`](scripts/README.md). Новый Python-скрипт создавайте из
шаблона `scripts/templates/python_cli.py` — он уже содержит аргументы `--log-level`, единый формат логов и проверки зависимостей.

## Проверки качества
- Линтеры: `make lint` или прямой вызов `ruff check` и `pyright` из виртуального окружения.
- Политика репозитория: `./scripts/ops/policy_validate.py`.
- Формат C-кода следует существующим файлам в `apps/` и `tests/`; отдельный форматтер не требуется.

## Дополнительные ресурсы
- [План релиза](docs/project_plan.md) описывает долгосрочные вехи и критерии готовности.
- [Описание скриптов](scripts/README.md) фиксирует категории (`build/`, `deploy/`, `ops/`, `experiments/`) и шаблоны.

## Режимы ответа Kolibri
Kolibri OS поддерживает два режима генерации ответов:

1. **Deterministic KolibriScript** — ответы собираются локально внутри браузера через WebAssembly-мост. Это режим по умолчанию.
2. **LLM Proxy** — запросы проксируются во внешний LLM через FastAPI-сервис.

Чтобы активировать режим LLM, задайте переменные окружения и запустите сервис:

```bash
export KOLIBRI_RESPONSE_MODE=llm
export KOLIBRI_LLM_ENDPOINT="https://llm.example.com/v1/infer"
export KOLIBRI_LLM_API_KEY="<token>"  # опционально
export KOLIBRI_LLM_MODEL="kolibri-pro"  # опционально
export KOLIBRI_LLM_TEMPERATURE="0.7"  # опционально, диапазон 0.0-2.0
export KOLIBRI_LLM_MAX_TOKENS="512"  # опционально, положительное целое
./scripts/ops/run_backend.sh --port 8080
```

Фронтенд ожидает те же настройки через Vite:

```bash
export VITE_KOLIBRI_RESPONSE_MODE=llm
export VITE_KOLIBRI_API_BASE="http://localhost:8080/api"
npm --prefix frontend run dev
```

Если `VITE_KOLIBRI_RESPONSE_MODE` не равен `llm`, интерфейс автоматически вернётся к KolibriScript. При ошибке LLM фронтенд
повторит запрос через KolibriScript и дополнит ответ примечанием о деградации.
