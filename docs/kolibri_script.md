# KolibriScript — язык мысли цифрового организма

## Назначение
KolibriScript служит естественным русскоязычным интерфейсом к цифровому ядру Kolibri. Интерпретатор читает сценарий, транслирует его в поток десятичных импульсов с помощью `kolibri_transducirovat_utf8` и передаёт команды в эволюционный пул формул, не нарушая Закон Единства.

Использование:

1. Подготовьте сценарий в файле `.ks`.
2. (Опционально) преобразуйте текст в десятичный формат `.ksd` с помощью утилиты `ks_compiler`:

   ```bash
   ./build/ks_compiler урок.ks -o урок.ksd
   ./build/ks_compiler --decode урок.ksd -o урок.txt
   ```

3. Запустите узел Kolibri и используйте команду REPL `:script путь.ks` или `:script путь.ksd`.
4. Все события автоматически фиксируются в `genome.dat` с типами `SCRIPT_START`, `SCRIPT_TEACH`, `SCRIPT_TICK`, `SCRIPT_ASK`, `SCRIPT_FORMULA` и `SCRIPT_FINISH`.

## Базовые конструкции

### Блок `начало … конец`
Сценарий начинается строкой `начало:` и заканчивается `конец.`. Все команды внутри блока выполняются последовательно.

```text
начало:
    показать "Kolibri готов к обучению"
конец.
```

### Команда `показать`
Выводит произвольный текст. Литерал заключён в кавычки.

```text
показать "Kolibri приветствует Первого Архитектора"
```

### Команда `обучить число`
Добавляет обучающий пример в пул формул. Аргументы задаются в виде `стимул -> ответ`.

```text
обучить число 2 -> 4
```

### Команда `тикнуть`
Запускает эволюцию на указанное количество поколений (минимум 1).

```text
тикнуть 32
```

### Команда `спросить число`
Применяет лучшую формулу к указанному входу и печатает результат.

```text
спросить число 2
```

### Команда `сохранить`
Фиксирует текущую лучшую формулу в цифровом геноме. Формула сериализуется в виде последовательности цифр и подписывается HMAC.

```text
сохранить лучшую формулу
```

## Минимальный сценарий

```text
начало:
    показать "Kolibri начинает цикл обучения"
    обучить число 2 -> 4
    обучить число 3 -> 9
    тикнуть 24
    спросить число 2
    сохранить лучшую формулу
конец.
```

## Запуск через REPL

```text
колибри-1> :script scripts/examples/lesson.ks
[Скрипт] f(2) = 4
[Скрипт] формула сохранена в геноме
```

## Журналирование событий

| Тип события | Содержимое | Назначение |
| --- | --- | --- |
| `SCRIPT_START` | пусто | Начало исполнения сценария |
| `SCRIPT_TEACH` | текст `пример добавлен` | Зафиксирован обучающий пример |
| `SCRIPT_TICK` | `эволюция выполнена` | Цикл мутации завершён |
| `SCRIPT_ASK` | `запрошено значение` | Скрипт запросил ответ формулы |
| `SCRIPT_FORMULA` | десятичные цифры гена | Формула сохранена в `genome.dat` |
| `SCRIPT_ERROR` | исходная строка | Ошибка разбора или выполнения |
| `SCRIPT_FINISH` | пусто | Сценарий выполнен без ошибок |

## Ограничения текущей версии

- Поддерживаются числовые аргументы. Строковые ассоциации и условия будут добавлены в последующих релизах.
- Для стабильного результата рекомендуется вызывать `тикнуть` с количеством поколений ≥ 16.
- Интерпретатор использует внутренний буфер на 16 384 цифры. Более объёмные сценарии следует разбивать на части.

## Дальнейшее развитие

- Расширение синтаксиса переменными и условными конструкциями.
- Добавление команд управления роем (`отправить`, `ожидать`, `подключить`).
- Цифровая подпись `.ksd`-артефактов и проверка целостности при запуске.
